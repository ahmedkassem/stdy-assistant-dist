import{Q as U}from"./QSelect.9edcaa34.js";import{I as F,Y as m,_ as I,d as M,G as f,P as Q,j as p,K as S,Q as v,R as s,O as k,H as y,M as w,ab as B,L as N}from"./index.e88ad099.js";import{Q as P}from"./QField.62c1a422.js";import{h as _,a as O}from"./auth.27c9e4d6.js";import{a as V}from"./axios.21178db7.js";import"./QItemLabel.ef0548aa.js";import"./selection.dc814625.js";import"./vue-i18n.c257f8c9.js";import"./index.31a62591.js";import"./_commonjsHelpers.4e997714.js";const j=F("commentsS",{state(){return{working:!1,student:null,found:!1,course:null,comment:null}},actions:{async create(){var t,o,n,i;if(this.working||this.comment==null||((t=this.student)==null?void 0:t.id)==null||((o=this.course)==null?void 0:o.id)==null)return;this.working=!0,this.comment.student=(n=this.student)==null?void 0:n.id,this.comment.course=(i=this.course)==null?void 0:i.id,(await V.post("/comments",this.comment,_())).status!=200?m.create("error creating new comment"):m.create("created"),this.clear()},clear(){var e;this.student=null,this.comment={text:"",course:(e=this.course)==null?void 0:e.id},this.working=!1},async update(){var t,o,n,i;if(this.working||((t=this.comment)==null?void 0:t.id)==null||((o=this.student)==null?void 0:o.id)==null||((n=this.course)==null?void 0:n.id)==null)return;this.working=!0,(await V.put(`/comments/${(i=this.comment)==null?void 0:i.id}`,{text:this.comment.text},_())).status!=200?m.create("error updating comment"):m.create("updated"),this.clear()},async findStudent(e){var o,n,i,b,d,l,a,c,h;if(this.course==null){m.create("please select course first");return}this.student=null,this.comment=null;const t=await V.post("/graphql",{query:`query{
          students(where:{
            user:{
              profile:{
                phoneNumber:"${e}"
              }
            }
          }){
            id
            barcode
            comments{
              id
              text
              course{
                id
              }
            }
            user{
              profile{
                name
                phoneNumber
              }
            }
            student_courses{
              course{
                id
              }
            }  
            student_lesson_views{
              lesson{
                course_section{
                  course{
                    id
                  }
                }
              }
            }
          }
        }`},_());if(this.student=t.data.data.students[0],this.student!=null){this.found=!1;for(const r of(o=this.student.student_courses)!=null?o:[])((n=this.course)==null?void 0:n.id)==((i=r.course)==null?void 0:i.id)&&(this.found=!0);for(const r of this.student.student_lesson_views)((b=this.course)==null?void 0:b.id)==((a=(l=(d=r.lesson)==null?void 0:d.course_section)==null?void 0:l.course)==null?void 0:a.id)&&(this.found=!0);if(this.found){m.create("student found"),this.comment={text:"",course:this.course.id,student:this.student.id};for(const r of(c=this.student.comments)!=null?c:[])((h=r.course)==null?void 0:h.id)==this.course.id&&(this.comment=r)}else m.create("student is found but is not subscribed to the course or have any screen on the course")}else m.create("student not found")}}}),D=M({name:"manage-comments",data(){return{commentsS:j(),authS:O(),phoneNumber:""}}}),E={class:"q-pa-md"},G=s("h1",null,"Manage Comments",-1),H={key:0},K={class:"row"},L=s("div",{class:"col-1"},"Barcode",-1),R={class:"col"},T={class:"row"},Y=s("div",{class:"col-1"},"Name",-1),z={class:"col"},A={class:"row"},J=s("div",{class:"col-1"},"Phone Number",-1),W={class:"col"};function X(e,t,o,n,i,b){var d,l,a,c,h,r,g,q,$,C;return f(),Q("div",E,[G,p(U,{modelValue:e.commentsS.course,"onUpdate:modelValue":t[0]||(t[0]=u=>e.commentsS.course=u),options:(d=e.authS.user)==null?void 0:d.courseOptions,"map-options":"","emit-value":"",clearable:"",label:"course"},null,8,["modelValue","options"]),p(P,{label:"Phone Number"},{default:S(()=>[p(B,{modelValue:e.phoneNumber,"onUpdate:modelValue":t[1]||(t[1]=u=>e.phoneNumber=u),class:"full-width"},null,8,["modelValue"])]),_:1}),p(v,{onClick:t[2]||(t[2]=u=>e.commentsS.findStudent(e.phoneNumber)),color:"primary",class:"q-ma-md q-pa-md full-width"},{default:S(()=>[N("Find Student")]),_:1}),((a=(l=e.commentsS.student)==null?void 0:l.user)==null?void 0:a.profile)!=null?(f(),Q("div",H,[s("div",K,[L,s("div",R,k(e.commentsS.student.barcode),1)]),s("div",T,[Y,s("div",z,k((h=(c=e.commentsS.student.user)==null?void 0:c.profile)==null?void 0:h.name),1)]),s("div",A,[J,s("div",W,k((g=(r=e.commentsS.student.user)==null?void 0:r.profile)==null?void 0:g.phoneNumber),1)]),e.commentsS.comment!=null?(f(),y(P,{key:0,label:"comment"},{default:S(()=>[p(B,{class:"full-width",modelValue:e.commentsS.comment.text,"onUpdate:modelValue":t[3]||(t[3]=u=>e.commentsS.comment.text=u)},null,8,["modelValue"])]),_:1})):w("",!0),((q=e.commentsS.comment)==null?void 0:q.id)==null&&(($=e.commentsS.student)==null?void 0:$.id)!=null&&e.commentsS.found?(f(),y(v,{key:1,color:"primary",class:"q-ma-md q-pa-md full-width",onClick:t[4]||(t[4]=u=>e.commentsS.create())},{default:S(()=>[N("create")]),_:1})):w("",!0),((C=e.commentsS.comment)==null?void 0:C.id)!=null?(f(),y(v,{key:2,color:"primary",class:"q-ma-md q-pa-md full-width",onClick:t[5]||(t[5]=u=>e.commentsS.update())},{default:S(()=>[N("update")]),_:1})):w("",!0)])):w("",!0)])}var me=I(D,[["render",X]]);export{me as default};
